<!DOCTYPE html>
<html>
  <head>
    <title>Welcome to Glitch!</title>
    <meta name="description" content="Can use browser title change">
    <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    Title : <input id="inputChangeTitle" /> <input type="button" id="buttonNavTitle" value="Move" />
    <script>
      var inputChangeTitle = document.querySelector("#inputChangeTitle");
      var buttonNavTitle = document.querySelector("#buttonNavTitle");
      
      setTitle( "Change Your title" );
            
      
      inputChangeTitle.addEventListener('change', inputChangeTitleChangeHandler);
      inputChangeTitle.addEventListener('keydown', inputChangeTitleKeyDownHandler);
      buttonNavTitle.addEventListener('click', buttonNavTitleClickHandler);
      buttonNavTitle.addEventListener('enter', buttonNavTitleEnterHandler);
      
      
      var title = getTitleFromUrl();
      if ( title ) {
        setTitle(title);
        setDomInnerHtml( inputChangeTitle, title );
      }
      
      setTimeout(function() {
        inputChangeTitle.focus();
      }, 10);
      
      function getUrl() {
        var url = location.origin + location.pathname;
        return url;
      }
      function getTitleFromUrl() {
        var title = "";
        var search = location.search.substring(1);
        if ( search ) {
          var params = JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}');  
          title = params.title;
        }        
        return title;
      }
      function navTitle(title) {
        var urlWithTitle = getUrl() + "?title=" + title;
        location.href = urlWithTitle;
      }
      
      
      function inputChangeTitleChangeHandler(event) {
        var title = inputChangeTitle.value;
        navTitle( title );
      }
      function inputChangeTitleKeyDownHandler(event) {
        var KEY = {ENTER: 13};
        var which = event.which || event.keyCode;
        if ( which == KEY.ENTER ) {
          var title = inputChangeTitle.value;
          navTitle( title ); 
        }
      }
      function buttonNavTitleClickHandler(event) {
        var title = inputChangeTitle.value;
        navTitle( title );
      }
      function buttonNavTitleEnterHandler(event) {
        var title = inputChangeTitle.value;
        navTitle( title );
      }
      
      
      /*
      function saveTitle(title) {
        setCookie('title', title, 7);
      }
      function restoreTitle() {
        var title = getCookie('title');
        console.log('restoreTitle : ' + title);
        if ( title ) {
          setTitle( title );
          setDomInnerHtml( inputChangeTitle, title );
        }
      }
      function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires="+ d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        console.log('setCookie : ' + document.cookie );
      }
      function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }
      */
      
      function setDomInnerHtml(dom, title) {
        dom.value = title;
      }
      function setTitle(title) {
        document.title = title;
      }
    </script>
  </body>
</html>
